<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í™ˆ í™”ë©´</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .container {
      display: flex; height: 100vh; /* í™”ë©´ ì „ì²´ ë†’ì´ */ flex-direction: row;}
    .chat-container {display: flex;flex-direction: column;flex: 1;border: 1px solid #ddd;border-radius: 8px;overflow: hidden;height: 70vh;}
    .chat-box {flex: 1;overflow-y: auto;padding: 15px;background-color: rgba(246, 242, 201, 0.7);border-bottom: 1px solid #ddd;display: flex;flex-direction: column; /* ë©”ì‹œì§€ ì—­ìˆœìœ¼ë¡œ ì •ë ¬ */}
    .chat-message {margin-bottom: 10px;padding: 10px;border-radius: 10px;max-width: calc(100% - 20px); /* ìë™ ì¡°ì • */word-break: break-word;display: inline-block; /* í•„ìš”ì‹œ ì¸ë¼ì¸ ë¸”ë¡ìœ¼ë¡œ */}
    .chat-message.user {color: black;background-color: #abd6f8;align-self: flex-end; /* ì˜¤ë¥¸ìª½ ì •ë ¬ */text-align: right; /* ë©”ì‹œì§€ ë‚´ìš© ì˜¤ë¥¸ìª½ ì •ë ¬ */}
    .chat-message.bot {color: black;background-color: #bcfab6;align-self: flex-start; /* ì™¼ìª½ ì •ë ¬ */text-align: left; /* ë©”ì‹œì§€ ë‚´ìš© ì™¼ìª½ ì •ë ¬ */}
    .chat-message.bot::before {content: 'ğŸ¤–';margin-right: 10px;font-size: 1.5em;}
    .keyword-buttons {display: flex;flex-wrap: wrap; /* ë²„íŠ¼ë“¤ì„ ì—¬ëŸ¬ ì¤„ë¡œ ë‚˜ëˆ„ë„ë¡ ì„¤ì • */padding: 50px;border-left: 1px solid #ddd;background-color: #fae4e4;width: 400px; /* ì»¨í…Œì´ë„ˆ ë„ˆë¹„ */height: 70vh; /* í‚¤ì›Œë“œ ë²„íŠ¼ ì»¨í…Œì´ë„ˆì˜ ë†’ì´ */overflow-y: auto; /* ë²„íŠ¼ì´ ë§ì„ ê²½ìš° ìŠ¤í¬ë¡¤ ê°€ëŠ¥ */}
    .keyword-button {background-color: #0278f8;margin: 15px; /* ë²„íŠ¼ ì‚¬ì´ì˜ ì—¬ë°± ì¡°ì • */padding: 10px 10px; /* ë²„íŠ¼ì˜ íŒ¨ë”© ì¡°ì • */font-size: 20px; /* ë²„íŠ¼ ê¸€ì í¬ê¸° ì¡°ì • */text-align: center; /* ë²„íŠ¼ í…ìŠ¤íŠ¸ ê°€ìš´ë° ì •ë ¬ */box-sizing: border-box; /* íŒ¨ë”©ê³¼ ë³´ë”ë¥¼ í¬í•¨í•˜ì—¬ ì´ ë„ˆë¹„ ê³„ì‚° */}
    .keyword-button:hover{background-color: #afd1ef;}
    .search-container {margin-top: 30px;display: flex;justify-content: center; /* ê°€ë¡œ ì¤‘ì•™ ì •ë ¬ */align-items: center; /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */}
    .search-form {display: flex;align-items: center;width: 100%; /* ì»¨í…Œì´ë„ˆì˜ ë„ˆë¹„ì— ë§ì¶”ê¸° */max-width: 600px; /* ìµœëŒ€ ë„ˆë¹„ ì„¤ì •, í•„ìš” ì‹œ ì¡°ì • */}
    .search-input {width: 100%; /* ì»¨í…Œì´ë„ˆì˜ ë„ˆë¹„ì— ë§ì¶”ê¸° */max-width: 500px; /* ìµœëŒ€ ë„ˆë¹„ ì„¤ì • */padding: 10px; /* ì—¬ë°± ì¡°ì • */font-size: 16px; /* ê¸€ì í¬ê¸° ì¡°ì • */border: 1px solid #ddd; /* í…Œë‘ë¦¬ ìŠ¤íƒ€ì¼ */border-radius: 4px; /* ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ */}
    .search-button {padding: 10px 20px; /* ë²„íŠ¼ì˜ íŒ¨ë”© ì¡°ì • */font-size: 16px; /* ê¸€ì í¬ê¸° ì¡°ì • */background-color: #007bff; /* ë²„íŠ¼ ë°°ê²½ìƒ‰ */color: white; /* ê¸€ì ìƒ‰ìƒ */border: none; /* í…Œë‘ë¦¬ ì œê±° */border-radius: 4px; /* ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ */cursor: pointer; /* í´ë¦­ ì‹œ ì»¤ì„œ ëª¨ì–‘ ë³€ê²½ */}
    .search-button:hover {background-color: #0056b3; /* ë²„íŠ¼ í˜¸ë²„ ì‹œ ìƒ‰ìƒ ë³€ê²½ */}
  </style>
</head>
<body>
<div class="d-flex">
  <!-- ë©”ì¸ ì½˜í…ì¸  -->
  <div class="container-fluid">
    <h1 class="text-center mt-3">Home</h1>
    <div class="search-container">
      <form id="searchForm" method="get" th:action="@{/search}" class="search-form">
        <input type="text" id="searchQuery" name="query" class="search-input" placeholder="ì•½ ì´ë¦„ì„ ê²€ìƒ‰í•´ì£¼ì„¸ìš”" required>
        <button type="submit" class="search-button">ê²€ìƒ‰</button>
      </form>

    </div>
    <h5 class="text-center mt-3 mb-3">ì±—ë´‡</h5>
    <div class="container">
      <div class="chat-container">
        <div id="chat-box" class="chat-box"></div>
      </div>
      <div class="keyword-buttons">
        <button type="button" class="btn btn-secondary keyword-button" onclick="submitKeyword('ë°œì—´')">ë°œì—´</button>
        <button type="button" class="btn btn-secondary keyword-button" onclick="submitKeyword('ë‘í†µ')">ë‘í†µ</button>
        <button type="button" class="btn btn-secondary keyword-button" onclick="submitKeyword('ì†Œí™”ë¶ˆëŸ‰')">ì†Œí™”ë¶ˆëŸ‰</button>
        <button type="button" class="btn btn-secondary keyword-button" onclick="submitKeyword('ë‘ë“œëŸ¬ê¸°')">ë‘ë“œëŸ¬ê¸°</button>
        <button type="button" class="btn btn-secondary keyword-button" onclick="submitKeyword('ëª¸ì‚´')">ëª¸ì‚´</button>
      </div>
    </div>
    <!-- ì‚¬ëŒë“¤ì´ ìì£¼ ì°¾ëŠ” ì•½ -->
    <section class="mt">
      <h2>ì‚¬ëŒë“¤ì´ ìì£¼ ì°¾ëŠ” ì•½</h2>
      <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
          <div class="carousel-item active">
            <div class="d-flex justify-content-between">
              <img src="/images/tylenol.png" class="d-block" width="400" height="100" alt="Tylenol">
              <img src="https://via.placeholder.com/400x200" class="d-block w-100 ms-2" alt="2nd">
            </div>
          </div>
          <div class="carousel-item">
            <div class="d-flex justify-content-between">
              <img src="https://via.placeholder.com/400x200" class="d-block w-100" alt="3rd">
              <img src="https://via.placeholder.com/400x200" class="d-block w-100 ms-2" alt="4th">
            </div>
          </div>
        </div>
        <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </a>
        <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </a>
      </div>
    </section>
    <!-- ì£¼ë³€ ì•½êµ­ -->
    <section class="mt-4">
      <h2>ì£¼ë³€ ì•½êµ­</h2>
      <div class="d-flex overflow-auto">
        <div class="p-2 text-center">
          <img src="https://via.placeholder.com/80" class="rounded" alt="Artist Song">
          <p>Artist<br>Song</p>
        </div>
        <!-- ì¶”ê°€ ì´ë¯¸ì§€ë“¤ -->
      </div>
    </section>
  </div>
</div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function submitKeyword(keyword) {
    fetch('/chat/send-message', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ message: keyword })
    })
            .then(response => response.json())
            .then(data => {
              const chatBox = document.querySelector('.chat-box');
              const userMessage = document.createElement('div');
              userMessage.className = 'chat-message user';
              userMessage.textContent = `${keyword}`;
              chatBox.appendChild(userMessage);

              if (data.info) {
                const infoMessage = document.createElement('div');
                infoMessage.className = 'chat-message bot';
                chatBox.appendChild(infoMessage);

                let i = 0;
                const typingEffect = () => {
                  if (i < data.info.length) {
                    infoMessage.textContent += data.info.charAt(i);
                    i++;
                    setTimeout(typingEffect, 30);
                  } else {
                    if (data.medicines && data.medicines.length > 0) {
                      const container = document.createElement('div');
                      container.style.display = 'flex';
                      container.style.flexWrap = 'wrap';
                      container.style.gap = '10px';
                      container.style.justifyContent = 'flex-start';

                      data.medicines.forEach(medicine => {
                        const medicineInfo = document.createElement('div');
                        medicineInfo.className = 'chat-message bot';
                        medicineInfo.style.display = 'flex';
                        medicineInfo.style.flexDirection = 'column';
                        medicineInfo.style.alignItems = 'center';
                        medicineInfo.style.width = '150px';
                        medicineInfo.style.margin = '10px';

                        const image = document.createElement('img');
                        image.src = medicine.image || 'https://via.placeholder.com/150';
                        image.alt = medicine.name;
                        image.style.width = '100px';
                        image.style.height = 'auto';
                        image.style.objectFit = 'cover';

                        const name = document.createElement('div');
                        name.textContent = medicine.name || 'ì´ë¦„ ì—†ìŒ';
                        name.style.fontWeight = 'bold';
                        name.style.textAlign = 'center';
                        name.style.marginTop = '5px';

                        image.onclick = () => {
                          window.location.href = '/compare'; // GET ìš”ì²­ìœ¼ë¡œ ì´ë™
                        };
                        name.onclick = () => {
                          window.location.href = '/compare'; // GET ìš”ì²­ìœ¼ë¡œ ì´ë™
                        };

                        medicineInfo.appendChild(image);
                        medicineInfo.appendChild(name);
                        container.appendChild(medicineInfo);
                      });

                      chatBox.appendChild(container);
                      chatBox.scrollTop = chatBox.scrollHeight;
                    } else {
                      const botMessage = document.createElement('div');
                      botMessage.className = 'chat-message bot';
                      botMessage.textContent = `ì±—ë´‡: ì•½ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
                      chatBox.appendChild(botMessage);
                    }
                  }
                };
                typingEffect();
              }
              chatBox.scrollTop = chatBox.scrollHeight;
            })
            .catch(error => console.error('Error:', error));
  }
</script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const searchForm = document.querySelector('.search-form');
    searchForm.addEventListener('submit', function(event) {
      event.preventDefault(); // í¼ ì œì¶œ ê¸°ë³¸ ë™ì‘ ë°©ì§€

      const searchInput = document.querySelector('.search-input').value;
      if (searchInput) {
        window.location.href = `/search?query=${encodeURIComponent(searchInput)}`;
        fetchSearchResults(searchInput);
      }
    });
    function fetchSearchResults(query) {
      fetch(`/search?query=${encodeURIComponent(query)}`, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json'
        }
      })
              .then(response => response.json())
              .then(data => {
                displaySearchResults(data);
              })
              .catch(error => console.error('Error:', error));
    }
  });
</script>
</body>
</html>
